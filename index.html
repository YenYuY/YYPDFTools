<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- æ¨™é¡Œ -->
    <title data-i18n="site_title">3Yå·¥å…·ç®±</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#111827',
                            card: '#1f2937',
                            text: '#f3f4f6',
                            border: '#374151'
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- æ ¸å¿ƒå‡½å¼åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic-to@1.3.0/dist/iife/heic-to.js"></script>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        
        // --- è‡ªå‹•åµæ¸¬é»‘æš—æ¨¡å¼ ---
        function updateTheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        updateTheme();
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme);
    </script>

    <style>
        .loader {
            border-top-color: #3b82f6;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Tab æŒ‰éˆ•æ¨£å¼ */
        .tab-btn {
            white-space: nowrap;
            padding: 1rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            color: #6b7280;
        }
        .dark .tab-btn { color: #9ca3af; }
        
        .tab-btn.active {
            border-bottom-color: #2563eb;
            color: #2563eb;
            font-weight: 700;
        }
        .dark .tab-btn.active {
            border-bottom-color: #60a5fa;
            color: #60a5fa;
        }

        .tab-btn:hover:not(.active) {
            color: #374151;
            background-color: #f9fafb;
        }
        .dark .tab-btn:hover:not(.active) {
            color: #e5e7eb;
            background-color: #374151;
        }

        /* æ‹–æ›³åˆ—è¡¨æ¨£å¼ */
        .dragging {
            opacity: 0.5;
            background-color: #e5e7eb;
            border: 2px dashed #9ca3af;
        }
        .dark .dragging { background-color: #4b5563; }
        .drag-over { border-top: 3px solid #3b82f6; }

        /* ä¸Šå‚³å€æ‹–æ›³æ™‚çš„é«˜äº®æ¨£å¼ */
        .upload-drag-active {
            border-style: solid !important;
            border-color: #3b82f6 !important; /* blue-500 */
            background-color: #eff6ff !important; /* blue-50 */
        }
        .dark .upload-drag-active {
            background-color: #374151 !important; /* gray-700 */
            border-color: #60a5fa !important; /* blue-400 */
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark-bg text-gray-800 dark:text-gray-200 font-sans min-h-screen flex flex-col transition-colors duration-300">

    <!-- å°è¦½åˆ— -->
    <nav class="bg-white dark:bg-dark-card shadow-sm sticky top-0 z-50 border-b dark:border-dark-border transition-colors">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex h-16 items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center gap-2">
                    <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    <span class="font-bold text-xl tracking-tight hidden sm:block text-gray-900 dark:text-white" data-i18n="nav_title">3Yå·¥å…·ç®±</span>
                </div>

                <!-- å³å´é¸å–® -->
                <div class="flex items-center gap-3">
                    <button onclick="openAboutModal()" class="text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 flex items-center gap-1">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span data-i18n="nav_about">é—œæ–¼æœ¬ç«™</span>
                    </button>
                    
                    <select id="lang-selector" onchange="changeLanguage(this.value)" class="text-sm border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 py-1 pl-2 pr-6">
                        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                        <option value="en">English</option>
                        <option value="ja">æ—¥æœ¬èª</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <!-- æ©«å‘æ»¾å‹•é¸å–® -->
    <div class="bg-white dark:bg-dark-card border-b dark:border-dark-border shadow-sm transition-colors">
        <div class="max-w-7xl mx-auto px-2">
            <div class="flex overflow-x-auto hide-scrollbar gap-2 justify-center" id="tab-container">
                <button onclick="switchTab('img')" class="tab-btn" id="btn-tab-img" data-i18n="tab_img">PDF è½‰åœ–ç‰‡</button>
                <button onclick="switchTab('img2pdf')" class="tab-btn text-teal-600 dark:text-teal-400" id="btn-tab-img2pdf" data-i18n="tab_img2pdf">åœ–ç‰‡ è½‰ PDF</button>
                <button onclick="switchTab('merge')" class="tab-btn active" id="btn-tab-merge" data-i18n="tab_merge">PDF åˆä½µ</button>
                <button onclick="switchTab('split')" class="tab-btn" id="btn-tab-split" data-i18n="tab_split">PDF åˆ†å‰²</button>
                <button onclick="switchTab('compress')" class="tab-btn" id="btn-tab-compress" data-i18n="tab_compress">PDF å£“ç¸®</button>
                <button onclick="switchTab('protect')" class="tab-btn" id="btn-tab-protect" data-i18n="tab_protect">PDF åŠ å¯†/è§£é–</button>
                <button onclick="switchTab('rotate')" class="tab-btn" id="btn-tab-rotate" data-i18n="tab_rotate">PDF æ—‹è½‰</button>
                <button onclick="switchTab('heic')" class="tab-btn text-purple-600 dark:text-purple-400" id="btn-tab-heic" data-i18n="tab_heic">HEIC è½‰ JPG</button>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="max-w-4xl mx-auto px-4 py-8 flex-grow w-full">

        <!-- 1. PDF è½‰åœ–ç‰‡ -->
        <section id="sec-img" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold dark:text-white" data-i18n="title_img">PDF è½‰ JPG/PNG</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_img">å°‡æ¯ä¸€é  PDF è½‰æ›ç‚ºåœ–ç‰‡ä¸¦æ‰“åŒ…ä¸‹è¼‰</p>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 transition-colors">
                <input type="file" id="file-img" class="hidden" accept="application/pdf">
                <!-- Drop Zone ID: drop-img -->
                <div id="drop-img" onclick="document.getElementById('file-img').click()" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-700 hover:border-blue-400 transition">
                    <p class="text-lg text-gray-600 dark:text-gray-300 font-medium" data-i18n="drop_pdf">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ PDF</p>
                </div>
                <div id="ctrl-img" class="hidden mt-4 pt-4 border-t dark:border-gray-700">
                    <p id="name-img" class="mb-2 font-bold text-gray-700 dark:text-gray-200"></p>
                    <div class="flex gap-2">
                        <select id="fmt-img" class="border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded px-2 py-2"><option value="jpeg">JPG</option><option value="png">PNG</option></select>
                        <button id="do-img" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full" data-i18n="btn_convert">é–‹å§‹è½‰æ›</button>
                    </div>
                    <div id="prog-img" class="hidden mt-2 text-sm text-blue-600 dark:text-blue-400" data-i18n="processing">è™•ç†ä¸­...</div>
                </div>
            </div>
        </section>

        <!-- 2. åœ–ç‰‡ è½‰ PDF -->
        <section id="sec-img2pdf" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-teal-700 dark:text-teal-400" data-i18n="title_img2pdf">åœ–ç‰‡ è½‰ PDF</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_img2pdf">å°‡å¤šå¼µåœ–ç‰‡åˆä½µç‚ºä¸€å€‹ PDF æª”æ¡ˆ</p>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 border-t-4 border-teal-500 transition-colors">
                <input type="file" id="file-img2pdf" class="hidden" accept="image/jpeg, image/png" multiple>
                <!-- Drop Zone ID: drop-img2pdf -->
                <div id="drop-img2pdf" onclick="document.getElementById('file-img2pdf').click()" class="border-2 border-dashed border-teal-200 dark:border-teal-900 bg-teal-50 dark:bg-gray-800 rounded-lg p-8 text-center cursor-pointer hover:bg-teal-100 dark:hover:bg-gray-700 transition">
                    <p class="text-lg text-teal-900 dark:text-teal-300 font-medium" data-i18n="drop_imgs">é»æ“Šæˆ–æ‹–æ›³é¸æ“‡å¤šå¼µåœ–ç‰‡ (JPG/PNG)</p>
                </div>
                
                <div id="ctrl-img2pdf" class="hidden mt-4 pt-4 border-t dark:border-gray-700">
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2" data-i18n="selected_imgs">å·²é¸æ“‡åœ–ç‰‡ï¼š</p>
                    <ul id="list-img2pdf" class="text-sm text-gray-700 dark:text-gray-300 mb-4 list-disc pl-5 max-h-40 overflow-y-auto"></ul>
                    
                    <button id="do-img2pdf" class="w-full bg-teal-600 text-white py-3 rounded hover:bg-teal-700 font-bold" data-i18n="btn_img2pdf_dl">åˆä½µä¸¦ä¸‹è¼‰ PDF</button>
                    <div id="prog-img2pdf" class="hidden mt-2 text-center text-sm text-teal-600 dark:text-teal-400">0%</div>
                </div>
            </div>
        </section>

        <!-- 3. PDF åˆä½µ -->
        <section id="sec-merge" class="block">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold dark:text-white" data-i18n="title_merge">PDF åˆä½µ</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_merge">å°‡å¤šå€‹ PDF ä¸²æ¥æˆä¸€å€‹æª”æ¡ˆï¼Œå¯æ‹–æ›³èª¿æ•´é †åº</p>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 transition-colors">
                <input type="file" id="file-merge" class="hidden" accept="application/pdf" multiple>
                <!-- Drop Zone ID: drop-merge -->
                <div id="drop-merge" onclick="document.getElementById('file-merge').click()" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-700 hover:border-blue-400 transition">
                    <p class="text-lg text-gray-600 dark:text-gray-300 font-medium" data-i18n="drop_pdfs">é»æ“Šæˆ–æ‹–æ›³é¸æ“‡å¤šå€‹ PDF</p>
                </div>
                
                <div id="merge-container" class="mt-6 hidden">
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-2 italic text-center" data-i18n="drag_hint">ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥æ‹–æ›³ä¸‹æ–¹çš„é …ç›®ä¾†èª¿æ•´åˆä½µé †åº</p>
                    <ul id="list-merge" class="space-y-2"></ul>
                    <button id="do-merge" class="mt-6 w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700 font-bold" data-i18n="btn_merge_dl">åˆä½µä¸¦ä¸‹è¼‰</button>
                </div>
            </div>
        </section>

        <!-- 4. PDF åˆ†å‰² -->
        <section id="sec-split" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold dark:text-white" data-i18n="title_split">PDF åˆ†å‰²</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_split">æå–æŒ‡å®šç¯„åœçš„é é¢å­˜ç‚ºæ–° PDF</p>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 transition-colors">
                <input type="file" id="file-split" class="hidden" accept="application/pdf">
                <!-- Drop Zone ID: drop-split -->
                <div id="drop-split" onclick="document.getElementById('file-split').click()" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-700 hover:border-blue-400 transition">
                    <p class="text-lg text-gray-600 dark:text-gray-300 font-medium" data-i18n="drop_pdf">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ PDF</p>
                </div>
                <div id="ctrl-split" class="hidden mt-4 pt-4 border-t dark:border-gray-700">
                    <p id="name-split" class="mb-4 font-bold text-gray-700 dark:text-gray-200"></p>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-i18n="lbl_start_page">èµ·å§‹é </label>
                            <input type="number" id="split-start" min="1" value="1" class="mt-1 block w-full border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md border p-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-i18n="lbl_end_page">çµæŸé </label>
                            <input type="number" id="split-end" min="1" value="1" class="mt-1 block w-full border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-md border p-2">
                        </div>
                    </div>
                    <button id="do-split" class="w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700 font-bold" data-i18n="btn_split_dl">åˆ†å‰²ä¸¦ä¸‹è¼‰</button>
                </div>
            </div>
        </section>

        <!-- 5. PDF å£“ç¸® -->
        <section id="sec-compress" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold dark:text-white" data-i18n="title_compress">PDF å£“ç¸® (é‡è£½)</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_compress">é€éå°‡ PDF è½‰ç‚ºåœ–ç‰‡å†é‡å»ºä¾†æ¸›å°‘æª”æ¡ˆå¤§å°</p>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 transition-colors">
                <input type="file" id="file-compress" class="hidden" accept="application/pdf">
                <!-- Drop Zone ID: drop-compress -->
                <div id="drop-compress" onclick="document.getElementById('file-compress').click()" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:bg-green-50 dark:hover:bg-gray-700 hover:border-green-400 transition">
                    <p class="text-lg text-gray-600 dark:text-gray-300 font-medium" data-i18n="drop_pdf">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ PDF</p>
                </div>
                <div id="ctrl-compress" class="hidden mt-4 pt-4 border-t dark:border-gray-700">
                    <p id="name-compress" class="mb-4 font-bold text-gray-700 dark:text-gray-200"></p>
                    <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 p-3 rounded mb-4 text-sm text-yellow-800 dark:text-yellow-200">
                        <strong data-i18n="note_title">æ³¨æ„ï¼š</strong> <span data-i18n="note_compress">æ­¤æ¨¡å¼æœƒå°‡æ‰€æœ‰é é¢è½‰ç‚ºåœ–ç‰‡ã€‚æ–‡å­—å°‡ç„¡æ³•é¸å–ï¼Œä½†å¯å¤§å¹…æ¸›å°‘æƒææª”çš„å¤§å°ã€‚</span>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" data-i18n="lbl_quality">åœ–ç‰‡å“è³ª (è¶Šä½æª”æ¡ˆè¶Šå°)</label>
                        <select id="compress-quality" class="w-full border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded p-2">
                            <option value="0.5">ä½ç•«è³ª (é«˜å£“ç¸®)</option>
                            <option value="0.7" selected>ä¸­ç•«è³ª (æ¨è–¦)</option>
                            <option value="0.9">é«˜ç•«è³ª (è¼•å¾®å£“ç¸®)</option>
                        </select>
                    </div>
                    <button id="do-compress" class="w-full bg-green-600 text-white py-3 rounded hover:bg-green-700 font-bold" data-i18n="btn_compress_dl">é–‹å§‹å£“ç¸®ä¸¦ä¸‹è¼‰</button>
                    <div id="prog-compress" class="hidden mt-2 text-center text-sm text-green-600 dark:text-green-400">0%</div>
                </div>
            </div>
        </section>

        <!-- 6. PDF åŠ å¯†/è§£é– -->
        <section id="sec-protect" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold dark:text-white" data-i18n="title_protect">PDF åŠ å¯†èˆ‡è§£é–</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_protect">ç‚ºæ–‡ä»¶è¨­å®šå¯†ç¢¼ï¼Œæˆ–ç§»é™¤å·²çŸ¥å¯†ç¢¼</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- åŠ å¯†å€ -->
                <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 border-t-4 border-blue-500 transition-colors">
                    <h3 class="font-bold text-lg mb-4 dark:text-white" data-i18n="subtitle_encrypt">åŠ å¯† (è¨­å®šå¯†ç¢¼)</h3>
                    <input type="file" id="file-encrypt" class="hidden" accept="application/pdf">
                    <!-- Drop Zone ID: drop-encrypt -->
                    <button id="drop-encrypt" onclick="document.getElementById('file-encrypt').click()" class="w-full border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center hover:bg-gray-50 dark:hover:bg-gray-700 mb-4 transition">
                        <span id="name-encrypt" class="text-gray-600 dark:text-gray-300 block truncate" data-i18n="select_file">é¸æ“‡æˆ–æ‹–æ›³æª”æ¡ˆ</span>
                    </button>
                    <div class="flex items-stretch gap-2 mb-4">
                        <input type="password" id="pass-encrypt" class="flex-1 border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded p-2" placeholder="è¨­å®šå¯†ç¢¼" data-i18n="ph_set_pass">
                        <button type="button" id="toggle-pass-encrypt" class="px-3 border border-gray-300 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600" data-i18n="show_pass">é¡¯ç¤º</button>
                    </div>
                    <button id="do-encrypt" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700" data-i18n="btn_encrypt">ä¸‹è¼‰åŠ å¯†æª”æ¡ˆ</button>
                </div>

                <!-- è§£é–å€ -->
                <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 border-t-4 border-red-500 transition-colors">
                    <h3 class="font-bold text-lg mb-4 dark:text-white" data-i18n="subtitle_unlock">è§£é– (ç§»é™¤å¯†ç¢¼)</h3>
                    <input type="file" id="file-unlock" class="hidden" accept="application/pdf">
                    <!-- Drop Zone ID: drop-unlock -->
                    <button id="drop-unlock" onclick="document.getElementById('file-unlock').click()" class="w-full border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center hover:bg-gray-50 dark:hover:bg-gray-700 mb-4 transition">
                        <span id="name-unlock" class="text-gray-600 dark:text-gray-300 block truncate" data-i18n="select_file">é¸æ“‡æˆ–æ‹–æ›³æª”æ¡ˆ</span>
                    </button>
                    <div class="flex items-stretch gap-2 mb-4">
                        <input type="password" id="pass-unlock" class="flex-1 border dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded p-2" placeholder="è¼¸å…¥åŸå§‹å¯†ç¢¼" data-i18n="ph_org_pass">
                        <button type="button" id="toggle-pass-unlock" class="px-3 border border-gray-300 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600" data-i18n="show_pass">é¡¯ç¤º</button>
                    </div>
                    <button id="do-unlock" class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700" data-i18n="btn_unlock">ä¸‹è¼‰è§£é–æª”æ¡ˆ</button>
                </div>
            </div>
        </section>

        <!-- 7. PDF æ—‹è½‰ -->
        <section id="sec-rotate" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold dark:text-white" data-i18n="title_rotate">PDF é é¢æ—‹è½‰</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_rotate">å°‡ PDF æ‰€æœ‰é é¢é€²è¡Œæ—‹è½‰</p>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 transition-colors">
                <input type="file" id="file-rotate" class="hidden" accept="application/pdf">
                <!-- Drop Zone ID: drop-rotate -->
                <div id="drop-rotate" onclick="document.getElementById('file-rotate').click()" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-700 hover:border-blue-400 transition">
                    <p class="text-lg text-gray-600 dark:text-gray-300 font-medium" data-i18n="drop_pdf">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ PDF</p>
                </div>
                <div id="ctrl-rotate" class="hidden mt-4 pt-4 border-t dark:border-gray-700">
                    <p id="name-rotate" class="mb-4 font-bold text-gray-700 dark:text-gray-200"></p>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" data-i18n="lbl_rotate_deg">é¸æ“‡æ—‹è½‰è§’åº¦ (é †æ™‚é‡)</label>
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button onclick="setRotate(90)" class="rotate-opt bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded border border-gray-200 dark:border-gray-600 dark:text-white" data-deg="90">90Â°</button>
                        <button onclick="setRotate(180)" class="rotate-opt bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded border border-gray-200 dark:border-gray-600 dark:text-white" data-deg="180">180Â°</button>
                        <button onclick="setRotate(270)" class="rotate-opt bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded border border-gray-200 dark:border-gray-600 dark:text-white" data-deg="270">270Â°</button>
                    </div>
                    <button id="do-rotate" class="w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700 font-bold" data-i18n="btn_rotate_dl">æ—‹è½‰ä¸¦ä¸‹è¼‰</button>
                </div>
            </div>
        </section>

        <!-- 8. HEIC è½‰ JPG -->
        <section id="sec-heic" class="hidden">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-purple-700 dark:text-purple-400" data-i18n="title_heic">HEIC è½‰ JPG</h2>
                <p class="text-gray-500 dark:text-gray-400" data-i18n="desc_heic">iPhone ç…§ç‰‡æ ¼å¼è½‰æ›ç‚ºé€šç”¨ JPG</p>
            </div>
            <div class="bg-white dark:bg-dark-card rounded-xl shadow p-6 border-t-4 border-purple-500 transition-colors">
                <input type="file" id="file-heic" class="hidden" accept=".heic, .heif" multiple>
                <!-- Drop Zone ID: drop-heic -->
                <div id="drop-heic" onclick="document.getElementById('file-heic').click()" class="border-2 border-dashed border-purple-200 dark:border-purple-900 bg-purple-50 dark:bg-gray-800 rounded-lg p-8 text-center cursor-pointer hover:bg-purple-100 dark:hover:bg-gray-700 transition">
                    <div class="flex flex-col items-center">
                        <svg class="w-10 h-10 text-purple-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <p class="text-lg text-purple-900 dark:text-purple-300 font-medium" data-i18n="drop_heic">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ HEIC æª”æ¡ˆ</p>
                    </div>
                </div>
                <div id="res-heic" class="hidden mt-6 text-center">
                    <p id="status-heic" class="text-sm font-bold text-gray-700 dark:text-gray-200 mb-2" data-i18n="processing">è½‰æ›ä¸­...</p>
                    <img id="preview-heic" class="max-w-full h-auto rounded shadow mx-auto mb-4" style="max-height: 300px;">
                    <div id="heic-list" class="text-left text-sm text-gray-700 dark:text-gray-300 space-y-2 mb-4"></div>
                    <button id="dl-heic-all" class="hidden bg-green-600 text-white px-6 py-2 rounded shadow hover:bg-green-700" data-i18n="btn_dl_all_jpg">ä¸‹è¼‰å…¨éƒ¨ JPG</button>
                </div>
            </div>
        </section>

    </main>

    <!-- é—œæ–¼æœ¬ç«™ Modal -->
    <div id="about-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full z-50 flex items-center justify-center">
        <div class="relative p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-gray-800 dark:border-gray-700">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-bold text-gray-900 dark:text-white mb-4" data-i18n="about_title">é—œæ–¼æœ¬ç«™</h3>
                <div class="mt-2 px-2 py-3">
                    <p class="text-sm text-gray-500 dark:text-gray-300 text-left leading-relaxed bg-gray-50 dark:bg-gray-700 p-3 rounded" data-i18n="about_content">
                        å…§å®¹...
                    </p>
                </div>
                <div class="mb-4 px-2">
                    <a href="https://github.com/YenYuY/YYPDFTools" target="_blank" class="inline-flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 w-full transition">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" /></svg>
                        <span data-i18n="github_btn">å‰å¾€ GitHub å°ˆæ¡ˆ</span>
                    </a>
                </div>
                <div class="items-center px-4 py-3">
                    <button onclick="document.getElementById('about-modal').classList.add('hidden')" class="px-4 py-2 bg-blue-500 text-white font-medium rounded-md w-full hover:bg-blue-700" data-i18n="btn_close">
                        äº†è§£ï¼Œé—œé–‰è¦–çª—
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white dark:bg-dark-card border-t dark:border-dark-border py-6 text-center text-gray-400 text-sm transition-colors">
        &copy; 2026 3Y Tools.
    </footer>

    <!-- é‚è¼¯è…³æœ¬ -->
    <script>
        const translations = {
            "zh-TW": {
                site_title: "3Yå·¥å…·ç®±",
                nav_title: "3Yå·¥å…·ç®±",
                nav_about: "é—œæ–¼æœ¬ç«™",
                tab_img: "PDF è½‰åœ–ç‰‡",
                tab_img2pdf: "åœ–ç‰‡ è½‰ PDF",
                tab_merge: "PDF åˆä½µ",
                tab_split: "PDF åˆ†å‰²",
                tab_compress: "PDF å£“ç¸®",
                tab_protect: "åŠ å¯†/è§£é–",
                tab_rotate: "PDF æ—‹è½‰",
                tab_heic: "HEIC è½‰ JPG",
                processing: "è™•ç†ä¸­...",
                drop_pdf: "é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ PDF",
                select_file: "é¸æ“‡æˆ–æ‹–æ›³æª”æ¡ˆ",
                // PDF to IMG
                title_img: "PDF è½‰ JPG/PNG",
                desc_img: "å°‡æ¯ä¸€é  PDF è½‰æ›ç‚ºåœ–ç‰‡ä¸¦æ‰“åŒ…ä¸‹è¼‰",
                btn_convert: "é–‹å§‹è½‰æ›",
                // IMG to PDF
                title_img2pdf: "åœ–ç‰‡ è½‰ PDF",
                desc_img2pdf: "å°‡å¤šå¼µåœ–ç‰‡åˆä½µç‚ºä¸€å€‹ PDF æª”æ¡ˆ",
                drop_imgs: "é»æ“Šæˆ–æ‹–æ›³é¸æ“‡å¤šå¼µåœ–ç‰‡ (JPG/PNG)",
                selected_imgs: "å·²é¸æ“‡åœ–ç‰‡ï¼š",
                btn_img2pdf_dl: "åˆä½µä¸¦ä¸‹è¼‰ PDF",
                // Merge
                title_merge: "PDF åˆä½µ",
                desc_merge: "å°‡å¤šå€‹ PDF ä¸²æ¥æˆä¸€å€‹æª”æ¡ˆï¼Œå¯æ‹–æ›³èª¿æ•´é †åº",
                drop_pdfs: "é»æ“Šæˆ–æ‹–æ›³é¸æ“‡å¤šå€‹ PDF",
                drag_hint: "ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥æ‹–æ›³ä¸‹æ–¹çš„é …ç›®ä¾†èª¿æ•´åˆä½µé †åº",
                btn_merge_dl: "åˆä½µä¸¦ä¸‹è¼‰",
                // Split
                title_split: "PDF åˆ†å‰²",
                desc_split: "æå–æŒ‡å®šç¯„åœçš„é é¢å­˜ç‚ºæ–° PDF",
                lbl_start_page: "èµ·å§‹é ",
                lbl_end_page: "çµæŸé ",
                btn_split_dl: "åˆ†å‰²ä¸¦ä¸‹è¼‰",
                // Compress
                title_compress: "PDF å£“ç¸® (é‡è£½)",
                desc_compress: "é€éå°‡ PDF è½‰ç‚ºåœ–ç‰‡å†é‡å»ºä¾†æ¸›å°‘æª”æ¡ˆå¤§å°",
                note_title: "æ³¨æ„ï¼š",
                note_compress: "æ­¤æ¨¡å¼æœƒå°‡æ‰€æœ‰é é¢è½‰ç‚ºåœ–ç‰‡ã€‚æ–‡å­—å°‡ç„¡æ³•é¸å–ï¼Œä½†å¯å¤§å¹…æ¸›å°‘æƒææª”çš„å¤§å°ã€‚",
                lbl_quality: "åœ–ç‰‡å“è³ª (è¶Šä½æª”æ¡ˆè¶Šå°)",
                btn_compress_dl: "é–‹å§‹å£“ç¸®ä¸¦ä¸‹è¼‰",
                // Protect
                title_protect: "PDF åŠ å¯†èˆ‡è§£é–",
                desc_protect: "ç‚ºæ–‡ä»¶è¨­å®šå¯†ç¢¼ï¼Œæˆ–ç§»é™¤å·²çŸ¥å¯†ç¢¼",
                subtitle_encrypt: "åŠ å¯† (è¨­å®šå¯†ç¢¼)",
                ph_set_pass: "è¨­å®šå¯†ç¢¼",
                btn_encrypt: "ä¸‹è¼‰åŠ å¯†æª”æ¡ˆ",
                subtitle_unlock: "è§£é– (ç§»é™¤å¯†ç¢¼)",
                ph_org_pass: "è¼¸å…¥åŸå§‹å¯†ç¢¼",
                btn_unlock: "ä¸‹è¼‰è§£é–æª”æ¡ˆ",
                show_pass: "é¡¯ç¤º",
                hide_pass: "éš±è—",
                // Rotate
                title_rotate: "PDF é é¢æ—‹è½‰",
                desc_rotate: "å°‡ PDF æ‰€æœ‰é é¢é€²è¡Œæ—‹è½‰",
                lbl_rotate_deg: "é¸æ“‡æ—‹è½‰è§’åº¦ (é †æ™‚é‡)",
                btn_rotate_dl: "æ—‹è½‰ä¸¦ä¸‹è¼‰",
                // HEIC
                title_heic: "HEIC è½‰ JPG",
                desc_heic: "iPhone ç…§ç‰‡æ ¼å¼è½‰æ›ç‚ºé€šç”¨ JPG",
                drop_heic: "é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³ HEIC æª”æ¡ˆ",
                btn_dl_jpg: "ä¸‹è¼‰ JPG",
                btn_dl_all_jpg: "ä¸‹è¼‰å…¨éƒ¨ JPG",
                // About
                about_title: "é—œæ–¼æœ¬ç«™",
                about_content: "æœ¬ç¶²ç«™çš„æ‰€æœ‰ PDF èˆ‡åœ–ç‰‡è™•ç†åŠŸèƒ½å‡å®Œå…¨åœ¨æ‚¨çš„ã€Œç€è¦½å™¨ç«¯ã€é‹è¡Œã€‚<br><br><strong>é€™æ„å‘³è‘—ï¼š</strong><br>1. æ‚¨çš„æª”æ¡ˆ<b>çµ•ä¸æœƒ</b>ä¸Šå‚³åˆ°æˆ‘å€‘çš„ä¼ºæœå™¨ã€‚<br>2. å³ä½¿æ²’æœ‰ç¶²è·¯ï¼Œé é¢è¼‰å…¥å¾Œä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚<br>3. æ‚¨çš„éš±ç§æ˜¯ 100% å®‰å…¨çš„ã€‚",
                github_btn: "å‰å¾€ GitHub å°ˆæ¡ˆ",
                btn_close: "äº†è§£ï¼Œé—œé–‰è¦–çª—"
            },
            "en": {
                site_title: "3Y Tools",
                nav_title: "3Y Tools",
                nav_about: "About",
                tab_img: "PDF to Image",
                tab_img2pdf: "Images to PDF",
                tab_merge: "Merge PDF",
                tab_split: "Split PDF",
                tab_compress: "Compress PDF",
                tab_protect: "Protect/Unlock",
                tab_rotate: "Rotate PDF",
                tab_heic: "HEIC to JPG",
                processing: "Processing...",
                drop_pdf: "Click or Drag to Upload PDF",
                select_file: "Select or Drag File",
                title_img: "PDF to JPG/PNG",
                desc_img: "Convert each PDF page to image",
                btn_convert: "Convert",
                title_img2pdf: "Images to PDF",
                desc_img2pdf: "Combine multiple images into one PDF",
                drop_imgs: "Click or Drag to Select Images (JPG/PNG)",
                selected_imgs: "Selected Images:",
                btn_img2pdf_dl: "Combine & Download PDF",
                title_merge: "Merge PDF",
                desc_merge: "Combine multiple PDFs into one, drag to reorder",
                drop_pdfs: "Click or Drag to Select Multiple PDFs",
                drag_hint: "ğŸ’¡ Tip: Drag items below to reorder",
                btn_merge_dl: "Merge & Download",
                title_split: "Split PDF",
                desc_split: "Extract pages to new PDF",
                lbl_start_page: "Start",
                lbl_end_page: "End",
                btn_split_dl: "Split & Download",
                title_compress: "Compress PDF (Rasterize)",
                desc_compress: "Reduce size by converting pages to images",
                note_title: "Note:",
                note_compress: "This converts pages to images. Text will not be selectable, but it reduces file size effectively for scans.",
                lbl_quality: "Image Quality (Lower = Smaller)",
                btn_compress_dl: "Compress & Download",
                title_protect: "Encrypt & Unlock",
                desc_protect: "Set password or remove password",
                subtitle_encrypt: "Encrypt (Set Password)",
                ph_set_pass: "Set Password",
                btn_encrypt: "Download Encrypted",
                subtitle_unlock: "Unlock (Remove Password)",
                ph_org_pass: "Enter Original Password",
                btn_unlock: "Download Unlocked",
                show_pass: "Show",
                hide_pass: "Hide",
                title_rotate: "Rotate PDF",
                desc_rotate: "Rotate all pages",
                lbl_rotate_deg: "Angle (Clockwise)",
                btn_rotate_dl: "Rotate & Download",
                title_heic: "HEIC to JPG",
                desc_heic: "Convert HEIC to JPG",
                drop_heic: "Click or Drag to Upload HEIC",
                btn_dl_jpg: "Download JPG",
                btn_dl_all_jpg: "Download All JPGs",
                about_title: "About",
                about_content: "All PDF and image processing functions on this website run entirely within your <b>Browser</b>.<br><br><strong>This means:</strong><br>1. Your files are <b>NEVER</b> uploaded to our servers.<br>2. You can use this site even without an internet connection after the page loads.<br>3. Your privacy is 100% secure.",
                github_btn: "Visit GitHub",
                btn_close: "Close"
            },
            "ja": {
                site_title: "3Y ãƒ„ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹",
                nav_title: "3Y ãƒ„ãƒ¼ãƒ«",
                nav_about: "æƒ…å ±",
                tab_img: "PDF ç”»åƒå¤‰æ›",
                tab_img2pdf: "ç”»åƒ PDF å¤‰æ›",
                tab_merge: "PDF çµåˆ",
                tab_split: "PDF åˆ†å‰²",
                tab_compress: "PDF åœ§ç¸®",
                tab_protect: "æš—å·åŒ–/è§£é™¤",
                tab_rotate: "PDF å›è»¢",
                tab_heic: "HEIC JPG å¤‰æ›",
                processing: "å‡¦ç†ä¸­...",
                drop_pdf: "PDF ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—",
                select_file: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°",
                title_img: "PDF ç”»åƒå¤‰æ›",
                desc_img: "å„ãƒšãƒ¼ã‚¸ã‚’ç”»åƒã«å¤‰æ›",
                btn_convert: "å¤‰æ›é–‹å§‹",
                title_img2pdf: "ç”»åƒ PDF å¤‰æ›",
                desc_img2pdf: "è¤‡æ•°ã®ç”»åƒã‚’ä¸€ã¤ã®PDFã«çµåˆ",
                drop_imgs: "ç”»åƒã‚’é¸æŠã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚° (JPG/PNG)",
                selected_imgs: "é¸æŠã•ã‚ŒãŸç”»åƒï¼š",
                btn_img2pdf_dl: "çµåˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                title_merge: "PDF çµåˆ",
                desc_merge: "è¤‡æ•°ã®PDFã‚’çµåˆ (ãƒ‰ãƒ©ãƒƒã‚°ã§ä¸¦ã³æ›¿ãˆ)",
                drop_pdfs: "è¤‡æ•°ã® PDF ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—",
                drag_hint: "ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼šãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é †åºã‚’å¤‰æ›´ã§ãã¾ã™",
                btn_merge_dl: "çµåˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                title_split: "PDF åˆ†å‰²",
                desc_split: "æŒ‡å®šç¯„å›²ã‚’æŠ½å‡º",
                lbl_start_page: "é–‹å§‹",
                lbl_end_page: "çµ‚äº†",
                btn_split_dl: "åˆ†å‰²ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                title_compress: "PDF åœ§ç¸® (ãƒ©ã‚¹ã‚¿ãƒ©ã‚¤ã‚º)",
                desc_compress: "ç”»åƒã‚’å†æ§‹ç¯‰ã—ã¦ã‚µã‚¤ã‚ºã‚’å‰Šæ¸›",
                note_title: "æ³¨æ„ï¼š",
                note_compress: "ãƒšãƒ¼ã‚¸å…¨ä½“ãŒç”»åƒåŒ–ã•ã‚Œã¾ã™ã€‚ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã¯ã§ãã¾ã›ã‚“ãŒã€ã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ãƒ¼ã‚¿ã®åœ§ç¸®ã«æœ‰åŠ¹ã§ã™ã€‚",
                lbl_quality: "ç”»è³ª (ä½ã„ã»ã©è»½é‡)",
                btn_compress_dl: "åœ§ç¸®ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                title_protect: "æš—å·åŒ–ã¨è§£é™¤",
                desc_protect: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã¾ãŸã¯è§£é™¤",
                subtitle_encrypt: "æš—å·åŒ– (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š)",
                ph_set_pass: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š",
                btn_encrypt: "æš—å·åŒ–ã—ã¦DL",
                subtitle_unlock: "è§£é™¤ (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å‰Šé™¤)",
                ph_org_pass: "å…ƒã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›",
                btn_unlock: "è§£é™¤ã—ã¦DL",
                show_pass: "è¡¨ç¤º",
                hide_pass: "éè¡¨ç¤º",
                title_rotate: "PDF å›è»¢",
                desc_rotate: "å…¨ãƒšãƒ¼ã‚¸ã‚’å›è»¢",
                lbl_rotate_deg: "è§’åº¦ (æ™‚è¨ˆå›ã‚Š)",
                btn_rotate_dl: "å›è»¢ã—ã¦DL",
                title_heic: "HEIC JPG å¤‰æ›",
                desc_heic: "HEIC ã‚’ JPG ã«å¤‰æ›",
                drop_heic: "HEIC ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—",
                btn_dl_jpg: "JPG DL",
                btn_dl_all_jpg: "ã™ã¹ã¦ã®JPGã‚’DL",
                about_title: "ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦",
                about_content: "ã“ã®Webã‚µã‚¤ãƒˆã®ã™ã¹ã¦ã®PDFãŠã‚ˆã³ç”»åƒå‡¦ç†æ©Ÿèƒ½ã¯ã€å®Œå…¨ã«<b>ãƒ–ãƒ©ã‚¦ã‚¶ä¸Š</b>ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚<br><br><strong>ã¤ã¾ã‚Šï¼š</strong><br>1. ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨ã¯<b>æ±ºã—ã¦ã‚ã‚Šã¾ã›ã‚“</b>ã€‚<br>2. ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒãªãã¦ã‚‚ä½¿ç”¨å¯èƒ½ã§ã™ã€‚<br>3. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¯100%å®ˆã‚‰ã‚Œã¾ã™ã€‚",
                github_btn: "GitHub ã¸",
                btn_close: "é–‰ã˜ã‚‹"
            }
        };

        let currentLang = 'zh-TW';
        function updatePasswordToggleLabel(btn, input) {
            if(!btn || !input) return;
            const key = input.type === 'password' ? 'show_pass' : 'hide_pass';
            btn.textContent = translations[currentLang][key] || (input.type === 'password' ? 'Show' : 'Hide');
        }
        function updatePasswordToggleLabels() {
            updatePasswordToggleLabel(document.getElementById('toggle-pass-encrypt'), document.getElementById('pass-encrypt'));
            updatePasswordToggleLabel(document.getElementById('toggle-pass-unlock'), document.getElementById('pass-unlock'));
        }
        function setupPasswordToggle(btnId, inputId) {
            const btn = document.getElementById(btnId);
            const input = document.getElementById(inputId);
            if(!btn || !input) return;
            btn.addEventListener('click', () => {
                input.type = input.type === 'password' ? 'text' : 'password';
                updatePasswordToggleLabel(btn, input);
            });
            updatePasswordToggleLabel(btn, input);
        }
        function changeLanguage(lang) {
            currentLang = lang;
            document.getElementById('lang-selector').value = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    if (el.placeholder) el.placeholder = translations[lang][key];
                    else el.innerHTML = translations[lang][key];
                }
            });
            updatePasswordToggleLabels();
        }
        window.addEventListener('load', () => {
            const l = navigator.language || navigator.userLanguage;
            if (l.startsWith('ja')) changeLanguage('ja');
            else if (l.startsWith('en')) changeLanguage('en');
            else changeLanguage('zh-TW');
            setupPasswordToggle('toggle-pass-encrypt', 'pass-encrypt');
            setupPasswordToggle('toggle-pass-unlock', 'pass-unlock');
        });
        function openAboutModal() { document.getElementById('about-modal').classList.remove('hidden'); }

        const tabs = ['img', 'img2pdf', 'merge', 'split', 'compress', 'protect', 'rotate', 'heic'];
        function switchTab(t) {
            tabs.forEach(x => {
                document.getElementById(`sec-${x}`).classList.add('hidden');
                document.getElementById(`btn-tab-${x}`).classList.remove('active');
            });
            document.getElementById(`sec-${t}`).classList.remove('hidden');
            document.getElementById(`btn-tab-${t}`).classList.add('active');
        }

        // ================= é€šç”¨ï¼šæ‹–æ›³ä¸Šå‚³è™•ç†å‡½å¼ =================
        function setupDragDrop(dropZoneId, fileInputId) {
            const dropZone = document.getElementById(dropZoneId);
            const fileInput = document.getElementById(fileInputId);

            if (!dropZone || !fileInput) return;

            // é˜»æ­¢é è¨­è¡Œç‚º
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }

            // æ‹–æ›³é€²ä¾†æ™‚åŠ ä¸Šæ¨£å¼
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.add('upload-drag-active'), false);
            });

            // æ‹–æ›³é›¢é–‹æˆ–æ”¾ä¸‹æ™‚ç§»é™¤æ¨£å¼
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.remove('upload-drag-active'), false);
            });

            // æ”¾ä¸‹æª”æ¡ˆ
            dropZone.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                fileInput.files = files; // å°‡æª”æ¡ˆæŒ‡æ´¾çµ¦ input
                fileInput.dispatchEvent(new Event('change')); // æ‰‹å‹•è§¸ç™¼ change äº‹ä»¶
            }, false);
        }

        // åˆå§‹åŒ–æ‰€æœ‰æ‹–æ›³å€å¡Š
        document.addEventListener('DOMContentLoaded', () => {
            setupDragDrop('drop-img', 'file-img');
            setupDragDrop('drop-img2pdf', 'file-img2pdf');
            setupDragDrop('drop-merge', 'file-merge');
            setupDragDrop('drop-split', 'file-split');
            setupDragDrop('drop-compress', 'file-compress');
            setupDragDrop('drop-encrypt', 'file-encrypt');
            setupDragDrop('drop-unlock', 'file-unlock');
            setupDragDrop('drop-rotate', 'file-rotate');
            setupDragDrop('drop-heic', 'file-heic');
        });

        // ================= åŠŸèƒ½é‚è¼¯ =================

        // 1. PDF è½‰åœ–ç‰‡
        let pdfImgFile = null;
        document.getElementById('file-img').addEventListener('change', e => {
            if(e.target.files[0]) {
                pdfImgFile = e.target.files[0];
                document.getElementById('name-img').textContent = pdfImgFile.name;
                document.getElementById('ctrl-img').classList.remove('hidden');
            }
        });
        document.getElementById('do-img').addEventListener('click', async () => {
            if(!pdfImgFile) return;
            const btn = document.getElementById('do-img');
            const prog = document.getElementById('prog-img');
            btn.disabled = true; btn.textContent = translations[currentLang]['processing'];
            prog.classList.remove('hidden');
            try {
                const pdf = await pdfjsLib.getDocument(await pdfImgFile.arrayBuffer()).promise;
                const zip = new JSZip();
                const fmt = document.getElementById('fmt-img').value;
                for(let i=1; i<=pdf.numPages; i++){
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({scale:2});
                    const canvas = document.createElement('canvas');
                    canvas.width = viewport.width; canvas.height = viewport.height;
                    await page.render({canvasContext:canvas.getContext('2d'), viewport}).promise;
                    const blob = await new Promise(r=>canvas.toBlob(r, `image/${fmt}`, 0.8));
                    zip.file(`page_${i}.${fmt==='jpeg'?'jpg':'png'}`, blob);
                    prog.textContent = `${Math.round(i/pdf.numPages*100)}%`;
                }
                saveAs(await zip.generateAsync({type:"blob"}), `${pdfImgFile.name}_images.zip`);
            } catch(e){ alert(e.message); }
            finally { btn.disabled=false; btn.textContent=translations[currentLang]['btn_convert']; prog.classList.add('hidden'); }
        });

        // 2. åœ–ç‰‡ è½‰ PDF
        let img2pdfFiles = [];
        document.getElementById('file-img2pdf').addEventListener('change', e => {
            if(e.target.files.length > 0){
                img2pdfFiles = Array.from(e.target.files);
                const list = document.getElementById('list-img2pdf');
                list.innerHTML = '';
                img2pdfFiles.forEach(f => {
                    const li = document.createElement('li');
                    li.textContent = f.name;
                    list.appendChild(li);
                });
                document.getElementById('ctrl-img2pdf').classList.remove('hidden');
            }
        });
        document.getElementById('do-img2pdf').addEventListener('click', async () => {
            if(img2pdfFiles.length === 0) return;
            const btn = document.getElementById('do-img2pdf');
            const prog = document.getElementById('prog-img2pdf');
            btn.disabled = true; btn.textContent = translations[currentLang]['processing'];
            prog.classList.remove('hidden');

            try {
                const { PDFDocument } = PDFLib;
                const pdfDoc = await PDFDocument.create();
                
                for(let i=0; i<img2pdfFiles.length; i++){
                    const file = img2pdfFiles[i];
                    const bytes = await file.arrayBuffer();
                    let img;
                    if(file.type === 'image/jpeg') img = await pdfDoc.embedJpg(bytes);
                    else if(file.type === 'image/png') img = await pdfDoc.embedPng(bytes);
                    else continue; // skip unsupport

                    const page = pdfDoc.addPage([img.width, img.height]);
                    page.drawImage(img, { x:0, y:0, width:img.width, height:img.height });
                    
                    prog.textContent = `Processing ${i+1}/${img2pdfFiles.length}`;
                }
                
                const pdfBytes = await pdfDoc.save();
                saveAs(new Blob([pdfBytes], {type:'application/pdf'}), 'images_combined.pdf');

            } catch(e){ alert(e.message); }
            finally { btn.disabled=false; btn.textContent=translations[currentLang]['btn_img2pdf_dl']; prog.classList.add('hidden'); }
        });

        // 3. PDF åˆä½µ (å«æ‹–æ›³æ’åº)
        let mergeFiles = [];
        const mergeContainer = document.getElementById('merge-container');
        const listMerge = document.getElementById('list-merge');

        document.getElementById('file-merge').addEventListener('change', e => {
            if(e.target.files.length) {
                mergeFiles = [...mergeFiles, ...Array.from(e.target.files)];
                renderMergeList();
            }
        });

        function renderMergeList() {
            if (mergeFiles.length > 0) mergeContainer.classList.remove('hidden');
            else mergeContainer.classList.add('hidden');

            listMerge.innerHTML = '';
            mergeFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center bg-gray-50 dark:bg-gray-700 p-3 rounded border dark:border-gray-600 cursor-move select-none transition-colors';
                li.draggable = true;
                li.dataset.index = index;
                li.innerHTML = `
                    <div class="flex items-center gap-2 overflow-hidden">
                        <span class="text-gray-400 dark:text-gray-500">â˜°</span>
                        <span class="truncate text-sm font-medium text-gray-700 dark:text-gray-200">${index + 1}. ${file.name}</span>
                    </div>
                    <button onclick="removeMerge(${index})" class="text-red-500 hover:text-red-700 dark:hover:text-red-400 font-bold px-2">âœ•</button>
                `;
                
                li.addEventListener('dragstart', handleDragStart);
                li.addEventListener('dragover', handleDragOver);
                li.addEventListener('drop', handleDrop);
                li.addEventListener('dragenter', handleDragEnter);
                li.addEventListener('dragleave', handleDragLeave);

                listMerge.appendChild(li);
            });
        }

        window.removeMerge = (i) => {
            mergeFiles.splice(i, 1);
            renderMergeList();
        };

        let dragSrcIndex = null;
        function handleDragStart(e) {
            this.classList.add('dragging');
            dragSrcIndex = Number(this.dataset.index);
            e.dataTransfer.effectAllowed = 'move';
        }
        function handleDragOver(e) {
            if (e.preventDefault) e.preventDefault();
            return false;
        }
        function handleDragEnter(e) { this.classList.add('drag-over'); }
        function handleDragLeave(e) { this.classList.remove('drag-over'); }
        function handleDrop(e) {
            e.stopPropagation();
            this.classList.remove('drag-over');
            const dragTargetIndex = Number(this.dataset.index);
            if (dragSrcIndex !== dragTargetIndex) {
                const item = mergeFiles[dragSrcIndex];
                mergeFiles.splice(dragSrcIndex, 1);
                mergeFiles.splice(dragTargetIndex, 0, item);
                renderMergeList();
            }
            return false;
        }

        document.getElementById('do-merge').addEventListener('click', async () => {
            if(mergeFiles.length < 2) return alert("Please select at least 2 files");
            const btn = document.getElementById('do-merge');
            btn.textContent = translations[currentLang]['processing'];
            try {
                const { PDFDocument } = PDFLib;
                const merged = await PDFDocument.create();
                for (let file of mergeFiles) {
                    const src = await PDFDocument.load(await file.arrayBuffer());
                    const pages = await merged.copyPages(src, src.getPageIndices());
                    pages.forEach(p => merged.addPage(p));
                }
                saveAs(new Blob([await merged.save()], {type:'application/pdf'}), 'merged.pdf');
            } catch(e) { alert("Merge failed: " + e.message); }
            finally { btn.textContent = translations[currentLang]['btn_merge_dl']; }
        });

        // 4. Split
        let splitFile, splitPdfDoc;
        document.getElementById('file-split').addEventListener('change', async e => {
            if(e.target.files[0]) {
                splitFile = e.target.files[0];
                document.getElementById('name-split').textContent = splitFile.name;
                const arr = await splitFile.arrayBuffer();
                splitPdfDoc = await PDFLib.PDFDocument.load(arr);
                const count = splitPdfDoc.getPageCount();
                document.getElementById('split-end').value = count;
                document.getElementById('split-end').max = count;
                document.getElementById('split-start').max = count;
                document.getElementById('ctrl-split').classList.remove('hidden');
            }
        });
        document.getElementById('do-split').addEventListener('click', async () => {
            if(!splitFile) return;
            const start = parseInt(document.getElementById('split-start').value)-1;
            const end = parseInt(document.getElementById('split-end').value)-1;
            try {
                const { PDFDocument } = PDFLib;
                const newPdf = await PDFDocument.create();
                const indices = []; for(let i=start; i<=end; i++) indices.push(i);
                const pages = await newPdf.copyPages(splitPdfDoc, indices);
                pages.forEach(p=>newPdf.addPage(p));
                saveAs(new Blob([await newPdf.save()],{type:'application/pdf'}), `split.pdf`);
            } catch(e){ alert(e.message); }
        });

        // 5. Compress
        let compressFile = null;
        document.getElementById('file-compress').addEventListener('change', e => {
            if(e.target.files[0]){
                compressFile = e.target.files[0];
                document.getElementById('name-compress').textContent = compressFile.name;
                document.getElementById('ctrl-compress').classList.remove('hidden');
            }
        });
        document.getElementById('do-compress').addEventListener('click', async () => {
            if(!compressFile) return;
            const btn = document.getElementById('do-compress');
            const prog = document.getElementById('prog-compress');
            const quality = parseFloat(document.getElementById('compress-quality').value);
            
            btn.disabled = true; btn.textContent = translations[currentLang]['processing'];
            prog.classList.remove('hidden');

            try {
                const pdfData = await compressFile.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument(pdfData);
                const pdf = await loadingTask.promise;
                const { PDFDocument } = PDFLib;
                const newPdf = await PDFDocument.create();

                for(let i=1; i<=pdf.numPages; i++){
                    const page = await pdf.getPage(i);
                    const scale = 1.5; 
                    const viewport = page.getViewport({scale: scale});
                    const canvas = document.createElement('canvas');
                    canvas.width = viewport.width; canvas.height = viewport.height;
                    
                    await page.render({canvasContext: canvas.getContext('2d'), viewport}).promise;
                    
                    const imgDataUrl = canvas.toDataURL('image/jpeg', quality);
                    const imgBytes = await fetch(imgDataUrl).then(res => res.arrayBuffer());
                    
                    const jpgImage = await newPdf.embedJpg(imgBytes);
                    const newPage = newPdf.addPage([viewport.width/scale, viewport.height/scale]);
                    newPage.drawImage(jpgImage, {
                        x: 0, y: 0,
                        width: viewport.width/scale,
                        height: viewport.height/scale
                    });
                    
                    prog.textContent = `Page ${i}/${pdf.numPages}`;
                }
                
                const pdfBytes = await newPdf.save();
                saveAs(new Blob([pdfBytes], {type: 'application/pdf'}), `compressed_${compressFile.name}`);

            } catch(e){ console.error(e); alert("Compress Error: " + e.message); }
            finally { btn.disabled=false; btn.textContent=translations[currentLang]['btn_compress_dl']; prog.classList.add('hidden'); }
        });

        // 6. Protect
        let encryptFile = null;
        document.getElementById('file-encrypt').addEventListener('change', e => {
            if(e.target.files[0]) {
                encryptFile = e.target.files[0];
                document.getElementById('name-encrypt').textContent = encryptFile.name;
            }
        });
        document.getElementById('do-encrypt').addEventListener('click', async () => {
            if(!encryptFile) return alert('è«‹é¸æ“‡æª”æ¡ˆ');
            const pwd = document.getElementById('pass-encrypt').value;
            if(!pwd) return alert('è«‹è¼¸å…¥å¯†ç¢¼');
            try {
                const { PDFDocument } = PDFLib;
                const pdf = await PDFDocument.load(await encryptFile.arrayBuffer());
                pdf.encrypt({ userPassword: pwd, ownerPassword: pwd });
                saveAs(new Blob([await pdf.save()], {type:'application/pdf'}), `encrypted_${encryptFile.name}`);
            } catch(e){ alert(e.message); }
        });
        
        let unlockFile = null;
        document.getElementById('file-unlock').addEventListener('change', e => {
            if(e.target.files[0]) {
                unlockFile = e.target.files[0];
                document.getElementById('name-unlock').textContent = unlockFile.name;
            }
        });
        document.getElementById('do-unlock').addEventListener('click', async () => {
            if(!unlockFile) return alert('è«‹é¸æ“‡æª”æ¡ˆ');
            const rawPwd = document.getElementById('pass-unlock').value;
            const pwd = rawPwd.trim();
            if(!pwd) return alert('è«‹è¼¸å…¥å¯†ç¢¼');
            try {
                const { PDFDocument } = PDFLib;
                const arr = await unlockFile.arrayBuffer();
                let pdf;
                try {
                    pdf = await PDFDocument.load(arr, { password: pwd });
                    saveAs(new Blob([await pdf.save()], {type:'application/pdf'}), `unlocked_${unlockFile.name}`);
                    return;
                } catch(err) {
                    if(err.message && err.message.includes('Password')) {
                        return alert('å¯†ç¢¼éŒ¯èª¤æˆ–æœªè¼¸å…¥');
                    }
                    if(err.message && err.message.includes('is encrypted')) {
                        // Some PDFs use encryption modes pdf-lib cannot fully decrypt.
                        try {
                            const encryptedDoc = await PDFDocument.load(arr, { ignoreEncryption: true });
                            const newDoc = await PDFDocument.create();
                            const pages = await newDoc.copyPages(encryptedDoc, encryptedDoc.getPageIndices());
                            pages.forEach(p => newDoc.addPage(p));
                            saveAs(new Blob([await newDoc.save()], {type:'application/pdf'}), `unlocked_${unlockFile.name}`);
                            return;
                        } catch(copyErr) {
                            return alert('æ­¤ PDF çš„åŠ å¯†æ–¹å¼ç›®å‰ç„¡æ³•è§£é–ï¼Œå¯èƒ½éœ€è¦æ“æœ‰è€…å¯†ç¢¼æˆ–ä½¿ç”¨ Acrobat å¦å­˜/åˆ—å°æˆ PDF å¾Œå†è™•ç†ã€‚');
                        }
                    }
                    throw err;
                }
            } catch(e){ alert("Unlock Error: " + e.message); }
        });

        // 7. Rotate
        let rotateFile, rotateDeg=90;
        document.getElementById('file-rotate').addEventListener('change', e => {
            if(e.target.files[0]){
                rotateFile=e.target.files[0];
                document.getElementById('name-rotate').textContent=rotateFile.name;
                document.getElementById('ctrl-rotate').classList.remove('hidden');
            }
        });
        window.setRotate = d => {
            rotateDeg=d;
            document.querySelectorAll('.rotate-opt').forEach(b=>{
                const on = parseInt(b.dataset.deg)===d;
                // è™•ç† Dark mode class
                if (on) {
                    b.className = 'rotate-opt bg-blue-100 dark:bg-blue-900/50 hover:bg-blue-200 dark:hover:bg-blue-800 py-2 rounded border border-blue-500 text-blue-700 dark:text-blue-300';
                } else {
                    b.className = 'rotate-opt bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 py-2 rounded border border-gray-200 dark:border-gray-600 dark:text-white';
                }
            });
        };
        setRotate(90);
        document.getElementById('do-rotate').addEventListener('click', async () => {
            if(!rotateFile) return;
            try {
                const { PDFDocument, degrees } = PDFLib;
                const pdf = await PDFDocument.load(await rotateFile.arrayBuffer());
                pdf.getPages().forEach(p => p.setRotation(degrees(p.getRotation().angle + rotateDeg)));
                saveAs(new Blob([await pdf.save()],{type:'application/pdf'}), `rotated.pdf`);
            } catch(e){ alert(e.message); }
        });

        // 8. HEIC
        document.getElementById('file-heic').addEventListener('change', e => {
            const files = Array.from(e.target.files || []); if(!files.length) return;
            const area=document.getElementById('res-heic');
            const list=document.getElementById('heic-list');
            const btnAll=document.getElementById('dl-heic-all');
            area.classList.remove('hidden');
            list.innerHTML = '';
            btnAll.classList.add('hidden');
            document.getElementById('status-heic').textContent = translations[currentLang]['processing'];

            const results = [];
            const makeRow = (name) => {
                const row = document.createElement('div');
                row.className = 'flex items-center justify-between gap-3';
                const left = document.createElement('div');
                left.className = 'truncate';
                const status = document.createElement('span');
                status.className = 'ml-2 text-xs text-gray-500 dark:text-gray-400';
                left.textContent = name;
                left.appendChild(status);
                const dlBtn = document.createElement('button');
                dlBtn.className = 'px-3 py-1 rounded bg-green-600 text-white text-xs hover:bg-green-700 disabled:opacity-50';
                dlBtn.textContent = translations[currentLang]['btn_dl_jpg'];
                dlBtn.disabled = true;
                row.appendChild(left);
                row.appendChild(dlBtn);
                list.appendChild(row);
                return { status, dlBtn };
            };

            (async () => {
                let previewSet = false;
                for (const f of files) {
                    const { status, dlBtn } = makeRow(f.name);
                    try {
                        const isHeic = await HeicTo.isHeic(f);
                        if (!isHeic) throw new Error('Not a HEIC/HEIF file');
                        const jpgBlob = await HeicTo({blob: f, type:"image/jpeg", quality:0.9});
                        results.push({ file: f, blob: jpgBlob });
                        status.textContent = 'OK';
                        dlBtn.disabled = false;
                        dlBtn.onclick = () => saveAs(jpgBlob, f.name.replace(/\..+/,".jpg"));
                        if (!previewSet) {
                            document.getElementById('preview-heic').src = URL.createObjectURL(jpgBlob);
                            previewSet = true;
                        }
                    } catch (err) {
                        status.textContent = 'Error';
                    }
                }
                document.getElementById('status-heic').textContent = results.length ? 'OK!' : 'Error';
                if (results.length) {
                    btnAll.classList.remove('hidden');
                    btnAll.onclick = () => {
                        results.forEach(r => saveAs(r.blob, r.file.name.replace(/\..+/,".jpg")));
                    };
                }
            })().catch(e=>document.getElementById('status-heic').textContent="Error:"+e.message);
        });

    </script>
</body>
</html>
